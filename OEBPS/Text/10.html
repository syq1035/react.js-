<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head><title></title>
<link href="../Styles/ebook.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ç»„ä»¶çš„ state å’Œ setState</h1>
    
      <ul style="font-size: 14px;">
  <li>
    ä½œè€…ï¼š<a href="https://www.zhihu.com/people/hu-zi-da-ha" target="_blank">èƒ¡å­å¤§å“ˆ</a>
  </li>
  <li>
    åŸæ–‡é“¾æ¥ï¼š<a href="http://huziketang.com/books/react/lesson10"> http://huziketang.com/books/react/lesson10 </a>
  </li>
  <li>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œä¿ç•™åŸæ–‡é“¾æ¥å’Œä½œè€…ä¿¡æ¯ã€‚</li>
</ul>

<h2 id="state" class="sigil_not_in_toc">state</h2>
<p>æˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€æ˜¯å¯ä»¥ç”±å®ƒæ•°æ®çŠ¶æ€å’Œé…ç½®å‚æ•°å†³å®šçš„ã€‚ä¸€ä¸ªç»„ä»¶å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œå°±åƒä¸€ä¸ªç‚¹èµæŒ‰é’®ï¼Œå¯ä»¥æœ‰â€œå·²ç‚¹èµâ€å’Œâ€œæœªç‚¹èµâ€çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿™ä¸¤ç§çŠ¶æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚React.js çš„ <code>state</code> å°±æ˜¯ç”¨æ¥å­˜å‚¨è¿™ç§å¯å˜åŒ–çš„çŠ¶æ€çš„ã€‚</p>

<p><a href="../Images/6caac0e901feb9f5579e79edda6a6f3b.jpg" target="_blank"><img src="../Images/6caac0e901feb9f5579e79edda6a6f3b.jpg" alt="React.js å°ä¹¦æ•™ç¨‹å›¾ç‰‡"/></a></p>

<p>æˆ‘ä»¬è¿˜æ˜¯æ‹¿ç‚¹èµæŒ‰é’®åšä¾‹å­ï¼Œå®ƒå…·æœ‰å·²ç‚¹èµå’Œæœªç‚¹èµä¸¤ç§çŠ¶æ€ã€‚é‚£ä¹ˆå°±å¯ä»¥æŠŠè¿™ä¸ªçŠ¶æ€å­˜å‚¨åœ¨ state ä¸­ã€‚ä¿®æ”¹ <code>src/index.js</code> ä¸ºï¼š</p>

<pre><code class="language-javascript">import React, { Component } from 'react'
import ReactDOM from 'react-dom'
import './index.css'

class LikeButton extends Component {
  constructor () {
    super()
    this.state = { isLiked: false }
  }

  handleClickOnLikeButton () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }

  render () {
    return (
      &lt;button onClick={this.handleClickOnLikeButton.bind(this)}&gt;
        {this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'} ğŸ‘
      &lt;/button&gt;
    )
  }
}
...
</code></pre>

<p><code>isLiked</code> å­˜æ”¾åœ¨å®ä¾‹çš„ <code>state</code> å¯¹è±¡å½“ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨æ„é€ å‡½æ•°é‡Œé¢åˆå§‹åŒ–ã€‚è¿™ä¸ªç»„ä»¶çš„ <code>render</code> å‡½æ•°å†…ï¼Œä¼šæ ¹æ®ç»„ä»¶çš„ <code>state</code> çš„ä¸­çš„<code>isLiked</code>ä¸åŒæ˜¾ç¤ºâ€œå–æ¶ˆâ€æˆ–â€œç‚¹èµâ€å†…å®¹ã€‚å¹¶ä¸”ç»™ <code>button</code> åŠ ä¸Šäº†ç‚¹å‡»çš„äº‹ä»¶ç›‘å¬ã€‚</p>

<p>æœ€åæ„å»ºä¸€ä¸ª <code>Index</code> ï¼Œåœ¨å®ƒçš„ <code>render</code> å‡½æ•°å†…ä½¿ç”¨ <code>LikeButton</code> ã€‚ç„¶åæŠŠ <code>Index</code> æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼š</p>

<pre><code class="language-javascript">...
class Index extends Component {
  render () {
    return (
      &lt;div&gt;
        &lt;LikeButton /&gt;
      &lt;/div&gt;
    )
  }
}

ReactDOM.render(
  &lt;Index /&gt;,
  document.getElementById('root')
)
</code></pre>

<h2 id="setstate-æ¥å—å¯¹è±¡å‚æ•°" class="sigil_not_in_toc">setState æ¥å—å¯¹è±¡å‚æ•°</h2>
<p>åœ¨ <code>handleClickOnLikeButton</code> äº‹ä»¶ç›‘å¬å‡½æ•°é‡Œé¢ï¼Œå¤§å®¶å¯ä»¥ç•™æ„åˆ°ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>setState</code> å‡½æ•°ï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½ä¼šæ›´æ–° <code>isLiked</code> å±æ€§ä¸º <code>!isLiked</code>ï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°ç‚¹èµå’Œå–æ¶ˆåŠŸèƒ½ã€‚</p>

<p><code>setState</code> æ–¹æ³•ç”±çˆ¶ç±» <code>Component</code> æ‰€æä¾›ã€‚<em>å½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼ŒReact.js ä¼šæ›´æ–°ç»„ä»¶çš„çŠ¶æ€ <code>state</code> ï¼Œå¹¶ä¸”é‡æ–°è°ƒç”¨ <code>render</code> æ–¹æ³•ï¼Œç„¶åå†æŠŠ <code>render</code> æ–¹æ³•æ‰€æ¸²æŸ“çš„æœ€æ–°çš„å†…å®¹æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š</em>ã€‚</p>

<p>æ³¨æ„ï¼Œå½“æˆ‘ä»¬è¦æ”¹å˜ç»„ä»¶çš„çŠ¶æ€çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ç”¨ <code>this.state = xxx</code>  è¿™ç§æ–¹å¼æ¥ä¿®æ”¹ï¼Œå¦‚æœè¿™æ ·åš React.js å°±æ²¡åŠæ³•çŸ¥é“ä½ ä¿®æ”¹äº†ç»„ä»¶çš„çŠ¶æ€ï¼Œå®ƒä¹Ÿå°±æ²¡æœ‰åŠæ³•æ›´æ–°é¡µé¢ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦ä½¿ç”¨ React.js æä¾›çš„ <code>setState</code> æ–¹æ³•ï¼Œ<em>å®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ä½œä¸ºå‚æ•°</em>ã€‚</p>

<p>ä¼ å…¥ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡è¡¨ç¤ºè¯¥ç»„ä»¶çš„æ–°çŠ¶æ€ã€‚ä½†ä½ åªéœ€è¦ä¼ å…¥éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å°±å¯ä»¥äº†ï¼Œè€Œä¸éœ€è¦ä¼ å…¥æ•´ä¸ªå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰å¦å¤–ä¸€ä¸ªçŠ¶æ€ <code>name</code> ï¼š</p>

<pre><code class="language-javascript">...
  constructor (props) {
    super(props)
    this.state = {
      name: 'Tomy',
      isLiked: false
    }
  }

  handleClickOnLikeButton () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }
...
</code></pre>

<p>å› ä¸ºç‚¹å‡»çš„æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦ä¿®æ”¹ <code>name</code>ï¼Œæ‰€ä»¥åªéœ€è¦ä¼ å…¥ <code>isLiked</code> å°±è¡Œäº†ã€‚Tomy è¿˜æ˜¯é‚£ä¸ª Tomyï¼Œè€Œ <code>isLiked</code> å·²ç»ä¸æ˜¯é‚£ä¸ª <code>isLiked</code> äº†ã€‚</p>

<h2 id="setstate-æ¥å—å‡½æ•°å‚æ•°" class="sigil_not_in_toc">setState æ¥å—å‡½æ•°å‚æ•°</h2>
<p>è¿™é‡Œè¿˜æœ‰è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½ è°ƒç”¨ <code>setState</code> çš„æ—¶å€™ï¼Œ<em>React.js å¹¶ä¸ä¼šé©¬ä¸Šä¿®æ”¹ state</em>ã€‚è€Œæ˜¯æŠŠè¿™ä¸ªå¯¹è±¡æ”¾åˆ°ä¸€ä¸ªæ›´æ–°é˜Ÿåˆ—é‡Œé¢ï¼Œç¨åæ‰ä¼šä»é˜Ÿåˆ—å½“ä¸­æŠŠæ–°çš„çŠ¶æ€æå–å‡ºæ¥åˆå¹¶åˆ° <code>state</code> å½“ä¸­ï¼Œç„¶åå†è§¦å‘ç»„ä»¶æ›´æ–°ã€‚è¿™ä¸€ç‚¹è¦å¥½å¥½æ³¨æ„ã€‚å¯ä»¥ä½“ä¼šä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">...
  handleClickOnLikeButton () {
    console.log(this.state.isLiked)
    this.setState({
      isLiked: !this.state.isLiked
    })
    console.log(this.state.isLiked)
  }
...
</code></pre>

<p>ä½ ä¼šå‘ç°ä¸¤æ¬¡æ‰“å°çš„éƒ½æ˜¯ <code>false</code>ï¼Œå³ä½¿æˆ‘ä»¬ä¸­é—´å·²ç» <code>setState</code> è¿‡ä¸€æ¬¡äº†ã€‚è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆ bugï¼Œåªæ˜¯ React.js çš„ <code>setState</code> æŠŠä½ çš„ä¼ è¿›æ¥çš„çŠ¶æ€ç¼“å­˜èµ·æ¥ï¼Œç¨åæ‰ä¼šå¸®ä½ æ›´æ–°åˆ° <code>state</code> ä¸Šï¼Œæ‰€ä»¥ä½ è·å–åˆ°çš„è¿˜æ˜¯åŸæ¥çš„ <code>isLiked</code>ã€‚</p>

<p>æ‰€ä»¥å¦‚æœä½ æƒ³åœ¨ <code>setState</code> ä¹‹åä½¿ç”¨æ–°çš„ <code>state</code> æ¥åšåç»­è¿ç®—å°±åšä¸åˆ°äº†ï¼Œä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">...
  handleClickOnLikeButton () {
    this.setState({ count: 0 }) // =&gt; this.state.count è¿˜æ˜¯ undefined
    this.setState({ count: this.state.count + 1}) // =&gt; undefined + 1 = NaN
    this.setState({ count: this.state.count + 2}) // =&gt; NaN + 2 = NaN
  }
...
</code></pre>

<p>ä¸Šé¢çš„ä»£ç çš„è¿è¡Œç»“æœå¹¶ä¸èƒ½è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼Œæˆ‘ä»¬å¸Œæœ› <code>count</code> è¿è¡Œç»“æœæ˜¯ <code>3</code> ï¼Œå¯æ˜¯æœ€åå¾—åˆ°çš„æ˜¯ <code>NaN</code>ã€‚ä½†æ˜¯è¿™ç§åç»­æ“ä½œä¾èµ–å‰ä¸€ä¸ª <code>setState</code> çš„ç»“æœçš„æƒ…å†µå¹¶ä¸ç½•è§ã€‚</p>

<p>è¿™é‡Œå°±è‡ªç„¶åœ°å¼•å‡ºäº† <code>setState</code> çš„ç¬¬äºŒç§ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚React.js ä¼šæŠŠä¸Šä¸€ä¸ª <code>setState</code> çš„ç»“æœä¼ å…¥è¿™ä¸ªå‡½æ•°ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¯¥ç»“æœè¿›è¡Œè¿ç®—ã€æ“ä½œï¼Œç„¶åè¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæ›´æ–° <code>state</code> çš„å¯¹è±¡ï¼š</p>

<pre><code class="language-javascript">...
  handleClickOnLikeButton () {
    this.setState((prevState) =&gt; {
      return { count: 0 }
    })
    this.setState((prevState) =&gt; {
      return { count: prevState.count + 1 } // ä¸Šä¸€ä¸ª setState çš„è¿”å›æ˜¯ count ä¸º 0ï¼Œå½“å‰è¿”å› 1
    })
    this.setState((prevState) =&gt; {
      return { count: prevState.count + 2 } // ä¸Šä¸€ä¸ª setState çš„è¿”å›æ˜¯ count ä¸º 1ï¼Œå½“å‰è¿”å› 3
    })
    // æœ€åçš„ç»“æœæ˜¯ this.state.count ä¸º 3
  }
...
</code></pre>

<p>è¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¸Šè¿°çš„<em>åˆ©ç”¨ä¸Šä¸€æ¬¡ <code>setState</code> ç»“æœè¿›è¡Œè¿ç®—</em>çš„æ•ˆæœã€‚</p>

<h2 id="setstate-åˆå¹¶" class="sigil_not_in_toc">setState åˆå¹¶</h2>
<p>ä¸Šé¢æˆ‘ä»¬è¿›è¡Œäº†ä¸‰æ¬¡ <code>setState</code>ï¼Œä½†æ˜¯å®é™…ä¸Šç»„ä»¶åªä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯ä¸‰æ¬¡ï¼›è¿™æ˜¯å› ä¸ºåœ¨ React.js å†…éƒ¨ä¼šæŠŠ JavaScript äº‹ä»¶å¾ªç¯ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—çš„åŒä¸€ä¸ªæ¶ˆæ¯ä¸­çš„ <code>setState</code> éƒ½è¿›è¡Œåˆå¹¶ä»¥åå†é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚</p>

<p>æ·±å±‚çš„åŸç†å¹¶ä¸éœ€è¦è¿‡å¤šçº ç»“ï¼Œä½ åªéœ€è¦è®°ä½çš„æ˜¯ï¼šåœ¨ä½¿ç”¨ React.js çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦æ‹…å¿ƒå¤šæ¬¡è¿›è¡Œ <code>setState</code> ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚</p>
</body>
</html>